import React, { createContext, useContext, useRef, ReactNode } from 'react';
import { Toast, ToastMessage as PrimeToastMessage } from 'primereact/toast';
import { useSafeState } from 'ahooks';
type Position =
    | 'center'
    | 'top-center'
    | 'top-left'
    | 'top-right'
    | 'bottom-center'
    | 'bottom-left'
    | 'bottom-right'
    | undefined;
type ExtendedToastMessage = PrimeToastMessage & {
    position?: Position;
};
type ToastContextType = {
    showToast: (params: ExtendedToastMessage) => void;
};

const ToastContext = createContext<ToastContextType | undefined>(undefined);

type ToastProviderProps = {
    children: ReactNode;
};
const ToastIcons: Record<string, JSX.Element> = {
    success: (
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
            <path
                d="M24.7711 8.67856L12.5364 21.0986L7.22973 15.7106C7.01895 15.4956 6.7674 15.3248 6.48981 15.2082C6.21222 15.0916 5.91415 15.0315 5.61307 15.0315C5.31198 15.0315 5.01392 15.0916 4.73632 15.2082C4.45873 15.3248 4.20718 15.4956 3.9964 15.7106C3.5718 16.1439 3.33398 16.7265 3.33398 17.3332C3.33398 17.9399 3.5718 18.5225 3.9964 18.9559L10.9217 25.9879C11.1325 26.2027 11.384 26.3733 11.6614 26.4898C11.9389 26.6063 12.2368 26.6663 12.5377 26.6663C12.8387 26.6663 13.1366 26.6063 13.414 26.4898C13.6915 26.3733 13.943 26.2027 14.1537 25.9879L28.0044 11.9252C28.4294 11.4918 28.6675 10.9089 28.6675 10.3019C28.6675 9.69484 28.4294 9.11201 28.0044 8.67856C27.7936 8.46356 27.5421 8.29276 27.2645 8.17616C26.9869 8.05957 26.6888 7.99951 26.3877 7.99951C26.0866 7.99951 25.7886 8.05957 25.511 8.17616C25.2334 8.29276 24.9818 8.46356 24.7711 8.67856Z"
                fill="#00CE7D"
            />
        </svg>
    ),
    error: (
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
            <path
                d="M16.0003 2.66675C23.3643 2.66675 29.3337 8.63608 29.3337 16.0001C29.3337 23.3641 23.3643 29.3334 16.0003 29.3334C8.63633 29.3334 2.66699 23.3641 2.66699 16.0001C2.66699 8.63608 8.63633 2.66675 16.0003 2.66675ZM16.0003 5.33341C13.1713 5.33341 10.4582 6.45722 8.45785 8.45761C6.45747 10.458 5.33366 13.1711 5.33366 16.0001C5.33366 18.8291 6.45747 21.5422 8.45785 23.5426C10.4582 25.5429 13.1713 26.6667 16.0003 26.6667C18.8293 26.6667 21.5424 25.5429 23.5428 23.5426C25.5432 21.5422 26.667 18.8291 26.667 16.0001C26.667 13.1711 25.5432 10.458 23.5428 8.45761C21.5424 6.45722 18.8293 5.33341 16.0003 5.33341ZM12.8443 11.0401L16.0003 14.1974L19.1563 11.0401C19.2748 10.9216 19.4154 10.8277 19.5702 10.7636C19.7249 10.6995 19.8908 10.6665 20.0583 10.6665C20.2258 10.6665 20.3917 10.6995 20.5465 10.7636C20.7013 10.8277 20.8419 10.9216 20.9603 11.0401C21.0788 11.1585 21.1727 11.2992 21.2368 11.4539C21.301 11.6087 21.3339 11.7746 21.3339 11.9421C21.3339 12.1096 21.301 12.2755 21.2368 12.4302C21.1727 12.585 21.0788 12.7256 20.9603 12.8441L17.803 16.0001L20.9603 19.1561C21.1996 19.3953 21.3339 19.7198 21.3339 20.0581C21.3339 20.3964 21.1996 20.7209 20.9603 20.9601C20.7211 21.1993 20.3966 21.3337 20.0583 21.3337C19.72 21.3337 19.3956 21.1993 19.1563 20.9601L16.0003 17.8027L12.8443 20.9601C12.7259 21.0785 12.5852 21.1725 12.4305 21.2366C12.2757 21.3007 12.1098 21.3337 11.9423 21.3337C11.7748 21.3337 11.6089 21.3007 11.4542 21.2366C11.2994 21.1725 11.1588 21.0785 11.0403 20.9601C10.9219 20.8416 10.8279 20.701 10.7638 20.5462C10.6997 20.3915 10.6667 20.2256 10.6667 20.0581C10.6667 19.8906 10.6997 19.7247 10.7638 19.5699C10.8279 19.4152 10.9219 19.2745 11.0403 19.1561L14.1977 16.0001L11.0403 12.8441C10.8011 12.6049 10.6667 12.2804 10.6667 11.9421C10.6667 11.6038 10.8011 11.2793 11.0403 11.0401C11.2796 10.8009 11.604 10.6665 11.9423 10.6665C12.2806 10.6665 12.6051 10.8009 12.8443 11.0401Z"
                fill="#FF3B54"
            />
        </svg>
    ),
    warn: (
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
            <path
                d="M16.0003 2.66675C23.3643 2.66675 29.3337 8.63608 29.3337 16.0001C29.3337 23.3641 23.3643 29.3334 16.0003 29.3334C8.63632 29.3334 2.66699 23.3641 2.66699 16.0001C2.66699 8.63608 8.63632 2.66675 16.0003 2.66675ZM16.0003 5.33341C13.1713 5.33341 10.4582 6.45722 8.45785 8.45761C6.45746 10.458 5.33366 13.1711 5.33366 16.0001C5.33366 18.8291 6.45746 21.5422 8.45785 23.5426C10.4582 25.5429 13.1713 26.6667 16.0003 26.6667C18.8293 26.6667 21.5424 25.5429 23.5428 23.5426C25.5432 21.5422 26.667 18.8291 26.667 16.0001C26.667 13.1711 25.5432 10.458 23.5428 8.45761C21.5424 6.45722 18.8293 5.33341 16.0003 5.33341ZM16.067 19.7334C16.2859 19.7334 16.5026 19.7765 16.7048 19.8603C16.907 19.944 17.0907 20.0668 17.2455 20.2216C17.4003 20.3763 17.523 20.5601 17.6068 20.7623C17.6905 20.9645 17.7337 21.1812 17.7337 21.4001C17.7337 21.6189 17.6905 21.8357 17.6068 22.0379C17.523 22.2401 17.4003 22.4238 17.2455 22.5786C17.0907 22.7334 16.907 22.8561 16.7048 22.9399C16.5026 23.0236 16.2859 23.0667 16.067 23.0667C15.625 23.0667 15.201 22.8912 14.8885 22.5786C14.5759 22.266 14.4003 21.8421 14.4003 21.4001C14.4003 20.9581 14.5759 20.5341 14.8885 20.2216C15.201 19.909 15.625 19.7334 16.067 19.7334ZM16.0003 9.33341C16.627 9.33341 17.1537 9.75475 17.2963 10.3241L17.323 10.4681L17.3337 10.6307V16.7027L17.323 16.8654C17.2777 17.1828 17.1186 17.4729 16.8752 17.6817C16.6319 17.8905 16.3209 18.0036 16.0003 18.0001C15.7048 18.0029 15.4168 17.9069 15.1821 17.7275C14.9473 17.548 14.7792 17.2953 14.7043 17.0094L14.6777 16.8654L14.667 16.7027V10.6307L14.6777 10.4681C14.7229 10.1507 14.8821 9.86055 15.1254 9.65179C15.3688 9.44303 15.6797 9.32988 16.0003 9.33341Z"
                fill="#FE8413"
            />
        </svg>
    ),
    // info: (
    //     <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
    //         <path
    //             d="M24.7711 8.67856L12.5364 21.0986L7.22973 15.7106C7.01895 15.4956 6.7674 15.3248 6.48981 15.2082C6.21222 15.0916 5.91415 15.0315 5.61307 15.0315C5.31198 15.0315 5.01392 15.0916 4.73632 15.2082C4.45873 15.3248 4.20718 15.4956 3.9964 15.7106C3.5718 16.1439 3.33398 16.7265 3.33398 17.3332C3.33398 17.9399 3.5718 18.5225 3.9964 18.9559L10.9217 25.9879C11.1325 26.2027 11.384 26.3733 11.6614 26.4898C11.9389 26.6063 12.2368 26.6663 12.5377 26.6663C12.8387 26.6663 13.1366 26.6063 13.414 26.4898C13.6915 26.3733 13.943 26.2027 14.1537 25.9879L28.0044 11.9252C28.4294 11.4918 28.6675 10.9089 28.6675 10.3019C28.6675 9.69484 28.4294 9.11201 28.0044 8.67856C27.7936 8.46356 27.5421 8.29276 27.2645 8.17616C26.9869 8.05957 26.6888 7.99951 26.3877 7.99951C26.0866 7.99951 25.7886 8.05957 25.511 8.17616C25.2334 8.29276 24.9818 8.46356 24.7711 8.67856Z"
    //             fill="#00CE7D"
    //         />
    //     </svg>
    // ),
};
const CloseIcon = (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <rect x="0.5" y="0.5" width="23" height="23" stroke="#252A40" />
        <path
            d="M19.5675 4.49788L19.4245 4.36788L19.3035 4.27788L19.1705 4.19888C18.8698 4.03305 18.5234 3.96924 18.1833 4.01702C17.8432 4.06481 17.5278 4.22161 17.2845 4.46388L12.0005 9.75088L6.73348 4.48488L6.67048 4.42488C6.01548 3.85688 5.07048 3.85788 4.49848 4.42888L4.38548 4.54888L4.27848 4.69288L4.19848 4.82588C4.03297 5.12668 3.96934 5.473 4.01711 5.81298C4.06488 6.15297 4.22149 6.46834 4.46348 6.71188L9.75348 12.0009L4.42848 17.3279C3.85848 17.9879 3.85848 18.9309 4.42848 19.5049L4.54848 19.6169L4.69248 19.7249L4.82548 19.8039C5.12619 19.9697 5.47258 20.0335 5.81265 19.9857C6.15271 19.938 6.46811 19.7812 6.71148 19.5389L11.9995 14.2489L17.3215 19.5739C17.9915 20.1549 18.9365 20.1349 19.5315 19.5389L19.6385 19.4209L19.7345 19.2889C19.9356 18.9834 20.0253 18.6179 19.9885 18.254C19.9517 17.8901 19.7907 17.5499 19.5325 17.2909L14.2455 11.9999L19.5085 6.73588L19.6055 6.63288C20.1455 6.00588 20.1305 5.06288 19.5675 4.49688V4.49788Z"
            fill="white"
        />
    </svg>
);
export const ToastProvider: React.FC<ToastProviderProps> = ({ children }) => {
    const toast = useRef<Toast>(null);
    const [customPosition, setCustomPosition] = useSafeState<Position>();

    const showToast = ({ severity, position = 'bottom-right', summary, detail, ...rest }: ExtendedToastMessage) => {
        setCustomPosition(position);
        toast.current?.show({
            severity,
            summary: (
                <span
                    className={`text-2xl font-bold ${severity === 'success' ? 'text-[#00CE7D]' : severity === 'error' ? 'text-[#FF4D4F]' : severity === 'warn' ? 'text-[#FE8413]' : 'text-[#1890FF]'}`}
                >
                    {summary}
                </span>
            ),
            detail: <div className="font-helvetica text-base font-normal leading-[1.5rem] text-white">{detail}</div>,
            className: 'bg-[#252A40]',
            contentClassName: 'border-none text-[1.5rem]',
            icon: severity ? ToastIcons[severity] : '',
            closeIcon: CloseIcon,
            ...rest,
        });
    };

    return (
        <ToastContext.Provider value={{ showToast }}>
            <Toast ref={toast} position={customPosition} className="opacity-1 z-[99999999999]" />
            {children}
        </ToastContext.Provider>
    );
};

export const useToast = (): ToastContextType => {
    const context = useContext(ToastContext);
    if (!context) {
        throw new Error('useToast must be used within a ToastProvider');
    }
    return context;
};
